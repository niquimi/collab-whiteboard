<!DOCTYPE html>
<html>
<head>
    <title>Collaborative Whiteboard</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { border: 1px solid #ccc; display: block; margin: auto; }
        #toolbar { position: fixed; top: 10px; left: 10px; z-index: 2; }
    </style>
</head>
<body>
    <div id="toolbar">
        <input type="number" id="lineWidth" value="2" min="1" max="10" title="Line Width">
        <button onclick="clearBoard()">Clear</button>
    </div>
    <canvas id="board" width="800" height="600"></canvas>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const canvas = document.getElementById('board');
        let lineWidthInput = document.getElementById('lineWidth');
        const ctx = canvas.getContext('2d');

        let drawing = false;
        let prev = null;

        let lineWidth = parseInt(lineWidthInput.value, 10);
        
        lineWidthInput.addEventListener('input', (e) => {
            lineWidth = e.target.value;
        });

        

        canvas.addEventListener("mousedown", (e) => {
            drawing = true;
            prev = { x: e.offsetX, y: e.offsetY };
        });
        canvas.addEventListener('mouseup', () => {drawing = false; prev = null;});
        canvas.addEventListener('mouseout', () => {drawing = false; prev = null;});

        canvas.addEventListener('mousemove', (e) => {
            if (!drawing) return;
            const current = { x: e.offsetX, y: e.offsetY };
            drawLine(prev, current);
            socket.emit('draw', { from: prev, to: current });
            prev = current;
        })

        socket.on("draw", ({ from, to }) => {
            drawLine(from, to, false);
        });

        function drawLine(from, to, local = false) {
            if(!from || !to) return;

            ctx.strokeStyle = "black";
            ctx.lineWidth =  lineWidth || 2;
            ctx.lineCap = "round";
            ctx.beginPath();
            ctx.moveTo(from.x, from.y);
            ctx.lineTo(to.x, to.y);
            ctx.stroke();
        }
        
        function clearBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            socket.emit('clear');
        }    

        socket.on("clear", () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
    </script>
</body>
</html>